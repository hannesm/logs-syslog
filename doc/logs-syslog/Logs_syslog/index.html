<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Logs_syslog (logs-syslog.Logs_syslog)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">logs-syslog</a> &#x00BB; Logs_syslog</nav><h1>Module <code>Logs_syslog</code></h1><p>Logs reporter using syslog</p><p>The <a href="http://erratique.ch/software/logs/doc/Logs.html">logs</a> library provides basic logging support, each log source has an independent logging level, and reporting is decoupled from logging.</p><p>This library implements log reporters via syslog, using <a href="http://verbosemo.de/syslog-message/">syslog-message</a>.</p><p>A variety of transport mechanisms are implemented:</p><ul><li><a href="https://tools.ietf.org/html/rfc3164">RFC 3164</a> specifies the original BSD syslog protocol over UDP on port 514 (also <a href="https://tools.ietf.org/html/rfc5426">RFC 5426</a>).</li><li><a href="https://tools.ietf.org/html/rfc6587">RFC 6587</a> specifies the historic syslog over TCP on port 514.</li><li><a href="https://tools.ietf.org/html/rfc5425">RFC 5425</a> specifies syslog over TLS on TCP port 6514.</li></ul><p>The UDP transport sends each log message to the remote log host using <code>sendto</code>. If <code>sendto</code> raises an <code>Unix.Unix_error</code>, this error is printed together with the log message on standard error.</p><p>When using a stream transport, TCP or TLS, the creation of a reporter attempts to establish a connection to the log host, and only results in <code>Ok</code> <span class="xref-unresolved" title="unresolved reference to &quot;Logs.reporter&quot;"><code>Logs</code>.reporter</span> on success, otherwise the <code>Error msg</code> is returned. At runtime when the connection failed, the message is printed on standard error, and a re-establishment of the connection is attempted.</p><p>Syslog messages need to be framed when transported over TCP and TLS streams. In the historical <a href="https://tools.ietf.org/html/rfc6587">RFC 6587</a> this is defined to be either non-transparent (which lets you stream the message), by terminating each syslog message with a line feed (0x0A), a null byte (0x00), a CR-LF sequence, or any custom byte sequence. The alternative is octet counting, also defined in <a href="https://tools.ietf.org/html/rfc5425">RFC 5425</a>, which prepends the message with the message length, ASCII-encoded as decimal number, followed by a whitespace (0x20). We support all three popular methods, and also a <code>`Custom</code> one appending any byte sequence at the end of each message. There are defaults (TCP: null byte, TLS: octet counting) passed to the individual reporter constructors (see the <a href="index.html#type-framing"><code>framing</code></a> type below).</p><p>Every time a library logs a message which reaches the reporter (depending on log level), the function <a href="index.html#val-message"><code>message</code></a> is evaluated with the <code>hostname</code> provided while creating the reporter, the log level is mapped to a syslog level, and the current timestamp is added. The log message is prepended with the log source name.</p><p>This module contains the pure fragments shared between the effectful implementation for <a href="../Logs_syslog_unix/index.html"><span>Unix</span></a>, <a href="../Logs_syslog_lwt/index.html"><span>Lwt</span></a>, and <a href="../Logs_syslog_mirage/index.html"><span>MirageOS</span></a>. TLS support is available for <a href="../Logs_syslog_lwt_tls/index.html"><span>Lwt</span></a> and <a href="../Logs_syslog_mirage_tls/index.html"><span>MirageOS</span></a>.</p><p>Not implemented is the reliable transport for syslog (see <a href="https://tools.ietf.org/html/rfc3195">RFC 3195</a>) (using port 601), which is an alternative transport of syslog messages over TCP.</p><p><em>v0.2.1 - <a href="https://github.com/hannesm/logs-syslog">homepage</a></em></p></header><dl><dt class="spec value" id="val-message"><a href="#val-message" class="anchor"></a><code><span class="keyword">val </span>message : ?&#8288;facility:Syslog_message.facility <span>&#45;&gt;</span> host:string <span>&#45;&gt;</span> source:string <span>&#45;&gt;</span> tags:Logs.Tag.set <span>&#45;&gt;</span> ?&#8288;header:string <span>&#45;&gt;</span> Logs.level <span>&#45;&gt;</span> Ptime.t <span>&#45;&gt;</span> string <span>&#45;&gt;</span> Syslog_message.t</code></dt><dd><p><code>message ~facility ~host ~source ~tags ~header level now msg</code> is <code>message</code>, a syslog message with the given values. The default <code>facility</code> is <code>Syslog_message.System_Daemons</code>.</p></dd></dl><dl><dt class="spec type" id="type-framing"><a href="#type-framing" class="anchor"></a><code><span class="keyword">type </span>framing</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-framing.LineFeed" class="anchored"><td class="def constructor"><a href="#type-framing.LineFeed" class="anchor"></a><code><span class="keyword">| </span></code><code>`LineFeed</code></td></tr><tr id="type-framing.Null" class="anchored"><td class="def constructor"><a href="#type-framing.Null" class="anchor"></a><code><span class="keyword">| </span></code><code>`Null</code></td></tr><tr id="type-framing.Custom" class="anchored"><td class="def constructor"><a href="#type-framing.Custom" class="anchor"></a><code><span class="keyword">| </span></code><code>`Custom<span class="keyword"> of </span>string</code></td></tr><tr id="type-framing.Count" class="anchored"><td class="def constructor"><a href="#type-framing.Count" class="anchor"></a><code><span class="keyword">| </span></code><code>`Count</code></td></tr></table><code> ]</code></dt><dd><p>Different framing methods used in the wild, as described in <a href="https://tools.ietf.org/html/rfc6587">RFC 6587</a></p></dd></dl><dl><dt class="spec value" id="val-frame_message"><a href="#val-frame_message" class="anchor"></a><code><span class="keyword">val </span>frame_message : string <span>&#45;&gt;</span> <a href="index.html#type-framing">framing</a> <span>&#45;&gt;</span> string</code></dt><dd><p><code>frame_msg msg framing</code> is <code>framed_message</code>, where the <code>framing</code> is applied.</p></dd></dl><dl><dt class="spec value" id="val-ppf"><a href="#val-ppf" class="anchor"></a><code><span class="keyword">val </span>ppf : Stdlib.Format.formatter</code></dt><dd><p><code>ppf</code> is a formatter</p></dd></dl><dl><dt class="spec value" id="val-flush"><a href="#val-flush" class="anchor"></a><code><span class="keyword">val </span>flush : unit <span>&#45;&gt;</span> string</code></dt><dd><p><code>flush ()</code> flushes the formatter, and return the <code>text</code></p></dd></dl><dl><dt class="spec value" id="val-facility"><a href="#val-facility" class="anchor"></a><code><span class="keyword">val </span>facility : Syslog_message.facility Logs.Tag.def</code></dt><dd><p><code>facility</code> is a <span class="xref-unresolved" title="unresolved reference to &quot;Logs.Tag.def&quot;"><span class="xref-unresolved" title="unresolved reference to &quot;Logs.Tag&quot;"><code>Logs</code>.Tag</span>.def</span> tag to give a message a different syslog facility from the reporter's default.</p></dd></dl></div></body></html>