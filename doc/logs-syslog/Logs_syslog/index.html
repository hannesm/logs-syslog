<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Logs_syslog (logs-syslog.Logs_syslog)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">logs-syslog</a> &#x00BB; Logs_syslog</nav><header class="odoc-preamble"><h1>Module <code><span>Logs_syslog</span></code></h1><p>Logs reporter using syslog</p><p>The <a href="http://erratique.ch/software/logs/doc/Logs.html">logs</a> library provides basic logging support, each log source has an independent logging level, and reporting is decoupled from logging.</p><p>This library implements log reporters via syslog, using <a href="http://verbosemo.de/syslog-message/">syslog-message</a>.</p><p>A variety of transport mechanisms are implemented:</p><ul><li><a href="https://tools.ietf.org/html/rfc3164">RFC 3164</a> specifies the original BSD syslog protocol over UDP on port 514 (also <a href="https://tools.ietf.org/html/rfc5426">RFC 5426</a>).</li><li><a href="https://tools.ietf.org/html/rfc6587">RFC 6587</a> specifies the historic syslog over TCP on port 514.</li><li><a href="https://tools.ietf.org/html/rfc5425">RFC 5425</a> specifies syslog over TLS on TCP port 6514.</li></ul><p>The UDP transport sends each log message to the remote log host using <code>sendto</code>. If <code>sendto</code> raises an <code>Unix.Unix_error</code>, this error is printed together with the log message on standard error.</p><p>When using a stream transport, TCP or TLS, the creation of a reporter attempts to establish a connection to the log host, and only results in <code>Ok</code> <code>Logs</code>.reporter on success, otherwise the <code>Error msg</code> is returned. At runtime when the connection failed, the message is printed on standard error, and a re-establishment of the connection is attempted.</p><p>Syslog messages need to be framed when transported over TCP and TLS streams. In the historical <a href="https://tools.ietf.org/html/rfc6587">RFC 6587</a> this is defined to be either non-transparent (which lets you stream the message), by terminating each syslog message with a line feed (0x0A), a null byte (0x00), a CR-LF sequence, or any custom byte sequence. The alternative is octet counting, also defined in <a href="https://tools.ietf.org/html/rfc5425">RFC 5425</a>, which prepends the message with the message length, ASCII-encoded as decimal number, followed by a whitespace (0x20). We support all three popular methods, and also a <code>`Custom</code> one appending any byte sequence at the end of each message. There are defaults (TCP: null byte, TLS: octet counting) passed to the individual reporter constructors (see the <a href="#type-framing"><code>framing</code></a> type below).</p><p>Every time a library logs a message which reaches the reporter (depending on log level), the function <a href="#val-message"><code>message</code></a> is evaluated with the <code>hostname</code> provided while creating the reporter, the log level is mapped to a syslog level, and the current timestamp is added. The log message is prepended with the log source name.</p><p>This module contains the pure fragments shared between the effectful implementation for <a href="../Logs_syslog_unix/index.html">Unix</a>, <a href="../Logs_syslog_lwt/index.html">Lwt</a>, and <span class="xref-unresolved">MirageOS</span>. TLS support is available for <a href="../Logs_syslog_lwt_tls/index.html">Lwt</a> and <span class="xref-unresolved">MirageOS</span>.</p><p>Not implemented is the reliable transport for syslog (see <a href="https://tools.ietf.org/html/rfc3195">RFC 3195</a>) (using port 601), which is an alternative transport of syslog messages over TCP.</p><p><em>v0.3.2 - <a href="https://github.com/hannesm/logs-syslog">homepage</a></em></p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-message"><a href="#val-message" class="anchor"></a><code><span><span class="keyword">val</span> message : 
  <span>?facility:<span class="xref-unresolved">Syslog_message</span>.facility <span class="arrow">&#45;&gt;</span></span>
  <span>host:string <span class="arrow">&#45;&gt;</span></span>
  <span>source:string <span class="arrow">&#45;&gt;</span></span>
  <span>tags:<span class="xref-unresolved">Logs</span>.Tag.set <span class="arrow">&#45;&gt;</span></span>
  <span>?header:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Logs</span>.level <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Ptime</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Syslog_message</span>.t</span></code></div><div class="spec-doc"><p><code>message ~facility ~host ~source ~tags ~header level now msg</code> is <code>message</code>, a syslog message with the given values. The default <code>facility</code> is <code>Syslog_message.System_Daemons</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-framing"><a href="#type-framing" class="anchor"></a><code><span><span class="keyword">type</span> framing</span><span> = </span><span>[ </span></code><ol><li id="type-framing.LineFeed" class="def constructor anchored"><a href="#type-framing.LineFeed" class="anchor"></a><code><span>| </span></code><code><span>`LineFeed</span></code></li><li id="type-framing.Null" class="def constructor anchored"><a href="#type-framing.Null" class="anchor"></a><code><span>| </span></code><code><span>`Null</span></code></li><li id="type-framing.Custom" class="def constructor anchored"><a href="#type-framing.Custom" class="anchor"></a><code><span>| </span></code><code><span>`Custom <span class="keyword">of</span> string</span></code></li><li id="type-framing.Count" class="def constructor anchored"><a href="#type-framing.Count" class="anchor"></a><code><span>| </span></code><code><span>`Count</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>Different framing methods used in the wild, as described in <a href="https://tools.ietf.org/html/rfc6587">RFC 6587</a></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-frame_message"><a href="#val-frame_message" class="anchor"></a><code><span><span class="keyword">val</span> frame_message : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-framing">framing</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>frame_msg msg framing</code> is <code>framed_message</code>, where the <code>framing</code> is applied.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ppf"><a href="#val-ppf" class="anchor"></a><code><span><span class="keyword">val</span> ppf : <span class="xref-unresolved">Stdlib</span>.Format.formatter</span></code></div><div class="spec-doc"><p><code>ppf</code> is a formatter</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-flush"><a href="#val-flush" class="anchor"></a><code><span><span class="keyword">val</span> flush : <span>unit <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p><code>flush ()</code> flushes the formatter, and return the <code>text</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-facility"><a href="#val-facility" class="anchor"></a><code><span><span class="keyword">val</span> facility : <span><span class="xref-unresolved">Syslog_message</span>.facility <span class="xref-unresolved">Logs</span>.Tag.def</span></span></code></div><div class="spec-doc"><p><code>facility</code> is a <code>Logs</code>.Tag.def tag to give a message a different syslog facility from the reporter's default.</p></div></div></div></body></html>