<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Logs_syslog_lwt_tls (logs-syslog.Logs_syslog_lwt_tls)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../index.html">logs-syslog</a> &#x00BB; Logs_syslog_lwt_tls</nav><header class="odoc-preamble"><h1>Module <code><span>Logs_syslog_lwt_tls</span></code></h1><p>Logs reporter via syslog using Lwt and TLS</p><p>Please read <a href="../Logs_syslog/index.html"><code>Logs_syslog</code></a> first.</p></header><nav class="odoc-toc"><ul><li><a href="#lwt_tls_example">Example usage</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec value" id="val-tcp_tls_reporter" class="anchored"><a href="#val-tcp_tls_reporter" class="anchor"></a><code><span><span class="keyword">val</span> tcp_tls_reporter : <span>?hostname:string <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Lwt_unix</span>.inet_addr <span class="arrow">&#45;&gt;</span></span> <span>?port:int <span class="arrow">&#45;&gt;</span></span> <span>cacert:string
<span class="arrow">&#45;&gt;</span></span> <span>cert:string <span class="arrow">&#45;&gt;</span></span> <span>priv_key:string <span class="arrow">&#45;&gt;</span></span> <span>?truncate:int <span class="arrow">&#45;&gt;</span></span> <span>?framing:<a href="../Logs_syslog/index.html#type-framing">Logs_syslog.framing</a> <span class="arrow">&#45;&gt;</span></span> <span>?facility:<span class="xref-unresolved">Syslog_message</span>.facility <span class="arrow">&#45;&gt;</span></span>
<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="xref-unresolved">Logs</span>.reporter, string)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p><code>tcp_tls_reporter ~hostname remote_ip ~port ~cacert ~cert ~priv_key ~truncate ~framing ()</code> is <code>Ok reporter</code> or <code>Error msg</code>. The TLS connection validates the certificate of the log server, it must be signed by <code>cacert</code>. The reporters credentials are its public <code>cert</code>, and its <code>priv_key</code>. The <code>reporter</code> sends each log message to <code>remote_ip, port</code> via TLS. If the initial TLS connection to the <code>remote_ip</code> fails, an <code>Error msg</code> is returned instead. If the TLS connection fails, the log message is reported to standard error, and an attempt is made to re-establish the TLS connection. Each message can be truncated after <code>truncate</code> bytes (defaults to no truncation). Each message is framed: by default a single byte containing 0 is appended, depending on <code>framing</code>, its length could be prepended, as specified in <a href="https://tools.ietf.org/html/rfc5125">RFC 5125</a>. The default value for <code>hostname</code> is <code>Lwt_unix.gethostname ()</code>, the default value for <code>port</code> is 6514. <code>facility</code> is the default syslog facility (see <a href="../Logs_syslog/index.html#val-message"><code>Logs_syslog.message</code></a>).</p></div></div><h3 id="lwt_tls_example"><a href="#lwt_tls_example" class="anchor"></a>Example usage</h3><p>To install a Lwt syslog reporter, sending via TLS to localhost, use the following snippet (assuming you already have certificates, and the common name of the collector is &quot;log server&quot;):</p><pre><code>let install_logger () =
  tls_reporter (Unix.inet_addr_of_string &quot;127.0.0.1&quot;)
    ~cacert:&quot;ca.pem&quot; ~cert:&quot;log.pem&quot; ~priv_key:&quot;log.key&quot;
    () &gt;|= function
  | Ok r -&gt; Logs.set_reporter r
  | Error e -&gt; print_endline e

let _ = Lwt_main.run (install_logger ())</code></pre></div></body></html>